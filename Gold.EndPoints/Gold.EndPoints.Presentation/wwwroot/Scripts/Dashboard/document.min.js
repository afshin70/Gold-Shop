function processStep1(n){var r=document.getElementById("DocumentNumber").value,t=document.getElementById("DocumentDate").value,i=document.getElementById("NationalCode").value,u=document.getElementById("Nationality").value;$.ajax({type:"Get",url:"/Dashboard/Document/ValidateDocDate",data:{documentDate:t},success:function(f){f!=undefined?f.IsSuccess?(newDocument.DocumentDate=t,f.Data?confirm(n)&&$.ajax({type:"Get",url:"/Dashboard/Document/ValidateStepOne",data:{docNumber:r,nationalCode:i,documentDate:t,nationality:u},success:function(n){n!=undefined?n.IsSuccess?(newDocument.DocumentNo=r,newDocument.DocumentDate=t,newDocument.NationalCode=i,newDocument.Nationality=u,n.Data?(newDocument.IsNewCstomer=!1,fillStep2_1Data(i),showStep2_1()):(newDocument.IsNewCstomer=!0,showStep2_2())):ShowAlertToast(n.Type,n.Title,n.Message):(ShowAlertToast(1,errorInProccessDataInServer,n),isExist=!1)},error:function(n){ShowAlertToast(1,errorInConnectToServer,n);isExist=!1}}):$.ajax({type:"Get",url:"/Dashboard/Document/ValidateStepOne",data:{docNumber:r,nationalCode:i,documentDate:t,nationality:u},success:function(n){n!=undefined?n.IsSuccess?(newDocument.DocumentNo=r,newDocument.DocumentDate=t,newDocument.NationalCode=i,newDocument.Nationality=u,n.Data?(newDocument.IsNewCstomer=!1,fillStep2_1Data(i),showStep2_1()):(newDocument.IsNewCstomer=!0,showStep2_2())):ShowAlertToast(n.Type,n.Title,n.Message):(ShowAlertToast(1,errorInProccessDataInServer,n),isExist=!1)},error:function(n){ShowAlertToast(1,errorInConnectToServer,n);isExist=!1}})):ShowAlertToast(f.Type,f.Title,f.Message):(ShowAlertToast(1,errorInProccessDataInServer,f),isExist=!1)},error:function(n){ShowAlertToast(1,errorInConnectToServer,n);isExist=!1}})}function processStep2_1(){$.ajax({type:"Get",url:`/Dashboard/Document/GetCustomerInfo?nationalCode=${newDocument.NationalCode}`,success:function(n){n!=undefined?n.IsSuccess?(newDocument.FullName=n.Data.FullName,newDocument.NationalCode=n.Data.NationalCode,newDocument.Mobile=n.Data.Mobile,newDocument.EssentialTel=n.Data.EssentialTel,document.getElementById("lable_fullname").innerHTML=newDocument.FullName,document.getElementById("lable_nationalCode").innerHTML=newDocument.NationalCode,document.getElementById("lable_mobile").innerHTML=newDocument.Mobile,document.getElementById("lable_essentialTel").innerHTML=newDocument.EssentialTel,document.getElementById("lable_documentNumebr").innerHTML=newDocument.DocumentNo,document.getElementById("lable_documentDate").innerHTML=newDocument.DocumentDate,showStep3()):ShowAlertToast(n.Type,n.Title,n.Message):(ShowAlertToast(1,errorInProccessDataInServer,n),isExist=!1)},error:function(n){ShowAlertToast(1,errorInConnectToServer,n);isExist=!1}})}function editCustomerInfo(n){try{event!=undefined&&event.preventDefault();var t="#"+n,i=n+"_body";$.ajax({type:"Get",url:"/Dashboard/Document/EditCustomerSummaryInfo",data:{nationalCode:newDocument.NationalCode},success:function(n){n.IsSuccess?(document.getElementById(i).innerHTML=n.Data,$(t).modal("show")):ShowAlertToast(n.Type,n.Title,n.Message)},error:function(n){ShowAlertToast(1,errorInProccessDataInServer,n)}})}catch(r){ShowAlertToast(2,errorInConnectToServer,r)}return!1}function processStep2_2(){newDocument.FullName=document.getElementById("FullName").value;newDocument.Gender=document.getElementById("Gender").value;newDocument.FatherName=document.getElementById("FatherName").value;newDocument.Mobile=document.getElementById("Mobile").value;newDocument.EssentialTel=document.getElementById("EssentialTel").value;newDocument.EssentialTelRatio=document.getElementById("EssentialTelRatio").value;newDocument.BirthDate=document.getElementById("BirthDate").value;newDocument.JobTitle=document.getElementById("JobTitle").value;newDocument.PostalCode=document.getElementById("PostalCode").value;newDocument.CityId=document.getElementById("CityId").value;newDocument.Address=document.getElementById("Address").value;newDocument.CardNumber=document.getElementById("CardNumber").value;newDocument.CardNumberOwner=document.getElementById("CardNumberOwner").value;$.ajax({type:"Get",url:"/Dashboard/Customer/IsDuplicateCustomerMobile",data:{id:0,mobile:newDocument.Mobile},success:function(n){if(n!=undefined)n?confirm("شماره تلفن همراه وارد شده برای مشتری دیگری ثبت شده است، آیا مایل به ثبت اطلاعات می باشید؟")==!0&&validateSecondStepData():validateSecondStepData();else return ShowAlertToast(1,errorInProccessDataInServer,data),!1},error:function(n){return ShowAlertToast(1,errorInProccessDataInServer,n),!1}})}function validateSecondStepData(){var n=new FormData;n.append("FullName",newDocument.FullName);n.append("Gender",newDocument.Gender);n.append("FatherName",newDocument.FatherName);n.append("Mobile",newDocument.Mobile);n.append("EssentialTel",newDocument.EssentialTel);n.append("EssentialTelRatio",newDocument.EssentialTelRatio);n.append("BirthDate",newDocument.BirthDate);n.append("JobTitle",newDocument.JobTitle);n.append("PostalCode",newDocument.PostalCode);n.append("CityId",newDocument.CityId);n.append("Address",newDocument.Address);n.append("CardNumber",newDocument.CardNumber);n.append("CardNumberOwner",newDocument.CardNumberOwner);$.ajax({type:"POST",url:`/Dashboard/Document/ValidateSecondStep`,data:n,processData:!1,contentType:!1,success:function(n){if(n!=undefined)n.IsSuccess?(document.getElementById("lable_fullname").innerHTML=newDocument.FullName,document.getElementById("lable_mobile").innerHTML=newDocument.Mobile,document.getElementById("lable_essentialTel").innerHTML=newDocument.EssentialTel,document.getElementById("lable_nationalCode").innerHTML=newDocument.NationalCode,document.getElementById("lable_documentNumebr").innerHTML=newDocument.DocumentNo,document.getElementById("lable_documentDate").innerHTML=newDocument.DocumentDate,showStep3()):ShowAlertToast(n.Type,n.Title,n.Message);else return ShowAlertToast(1,errorInProccessDataInServer,n),!1},error:function(n){return ShowAlertToast(1,errorInConnectToServer,n),!1}})}function processStep3(){var t=document.getElementById("InstallmentAmount").value,n=document.getElementById("InstallmentCount").value,i=document.getElementById("RemainAmount").value,r=document.getElementById("PrepaymentAmount").value,u=document.getElementById("AdminDescription").value;$.ajax({type:"Get",url:"/Dashboard/Document/GetInstallmentsDate",data:{installmentCount:n,installmentDate:newDocument.DocumentDate},success:function(f){var e,o;if(f!=undefined)if(f.IsSuccess){for(newDocument.InstallmentAmount=t,newDocument.InstallmentCount=n,newDocument.RemainAmount=i,newDocument.AdminDescription=u,newDocument.PrepaymentAmount=r,newDocument.SellerName=$("#Seller option:selected").text(),newDocument.GalleryName=$("#Gallery option:selected").text(),newDocument.GalleryId=document.getElementById("Gallery").value,newDocument.SellerId=document.getElementById("Seller").value,newDocument.InstallmentAmount==""||newDocument.InstallmentCount==""||newDocument.InstallmentCount<1||newDocument.RemainAmount==""||newDocument.PrepaymentAmount==""||newDocument.GalleryId==""||newDocument.GalleryId=="انتخاب کنید"||newDocument.SellerId==""||newDocument.SellerId=="انتخاب کنید"||GuaranteeList.length<1?(GuaranteeList.length<1&&ShowAlertToast(1,"هشدار","حداقل یک ضمانت برای سند باید ثبت شود"),isValidStep3=!1):isValidStep3=!0,InstallmentList=[],e=0;e<f.Data.length;e++)InstallmentList.push({Row:f.Data[e].Row,DelayDays:0,Description:"",InstalmentDate:f.Data[e].PersianDate,PaymentAmount:newDocument.InstallmentAmount});if(isValidStep3){for(document.getElementById("installment_list").innerHTML="",e=0;e<InstallmentList.length;e++)o=`<tr>
                                    <td>${InstallmentList[e].Row}</td>
                                    <td>${InstallmentList[e].InstalmentDate}</td>
                                    <td></td>
                                    <td></td>
                                    <td>${commaSeparateNumber(newDocument.InstallmentAmount)}</td>
                                    <td><input value='${InstallmentList[e].Row}' class='checkbox-disable' type="checkbox"></input></td>
                                    <td></td>
                                </tr>`,document.getElementById("installment_list").innerHTML+=o;document.getElementById("step4_nationalcode").innerHTML=newDocument.NationalCode;document.getElementById("step4_docDate").innerHTML=newDocument.DocumentDate;document.getElementById("step4_fullname").innerHTML=newDocument.FullName;document.getElementById("step4_mobile").innerHTML=newDocument.Mobile;document.getElementById("step4_essentiatel").innerHTML=newDocument.EssentialTel;document.getElementById("step4_docNumber").innerHTML=newDocument.DocumentNo;document.getElementById("step4_factorAmount").innerHTML=commaSeparateNumber(newDocument.FactorAmount);document.getElementById("step4_prePaymentAmount").innerHTML=commaSeparateNumber(newDocument.PrepaymentAmount);document.getElementById("step4_remainAmount").innerHTML=commaSeparateNumber(newDocument.RemainAmount);document.getElementById("step4_installmentAmount").innerHTML=commaSeparateNumber(newDocument.InstallmentAmount);document.getElementById("step4_installmentCount").innerHTML=newDocument.InstallmentCount;document.getElementById("step4_adminDesription").innerHTML=newDocument.AdminDescription;document.getElementById("step4_gallery").innerHTML=newDocument.GalleryName;document.getElementById("step4_seller").innerHTML=newDocument.SellerName;showStep4()}else ShowAlertToast(1,"هشدار","لطفا اطلاعات سند را به درستی وارد کنید.")}else ShowAlertToast(f.Type,f.Title,f.Message);else ShowAlertToast(1,"خطا در محاسبه اقساط.",f)},error:function(n){ShowAlertToast(1,errorInProccessDataInServer,n);isExist=!1}})}function isDuplicateCustomerMobile(n,t){$.ajax({type:"Get",url:"/Dashboard/Customer/IsDuplicateCustomerMobile",data:{id:t,mobile:n},success:function(n){return n!=undefined?n?confirm("شماره تلفن همراه وارد شده برای مشتری دیگری ثبت شده است، آیا مایل به ثبت اطلاعات می باشید؟")==!0?!0:!1:!1:(ShowAlertToast(1,errorInProccessDataInServer,data),!1)},error:function(n){return ShowAlertToast(1,errorInProccessDataInServer,n),!1}})}function processStep4(){try{event!=undefined&&event.preventDefault();document.getElementById("btnSubmit").disabled=!0;$.ajax({type:"Get",url:"/Dashboard/Customer/IsDuplicateCustomerMobile",data:{id:newDocument.CustomerId,mobile:newDocument.Mobile},success:function(n){if(n!=undefined)n?confirm("شماره تلفن همراه وارد شده برای مشتری دیگری ثبت شده است، آیا مایل به ثبت اطلاعات می باشید؟")==!0?submitDocumentDataForCreate():document.getElementById("btnSubmit").disabled=!1:submitDocumentDataForCreate();else return document.getElementById("btnSubmit").disabled=!1,ShowAlertToast(1,errorInProccessDataInServer,data),!1},error:function(n){return document.getElementById("btnSubmit").disabled=!1,ShowAlertToast(1,errorInProccessDataInServer,n),!1}})}catch(n){document.getElementById("btnSubmit").disabled=!1;ShowAlertToast(2,errorInConnectToServer,n)}return!1}function submitDocumentDataForCreate(){var n=new FormData,t;for(n.append("DocumentNo",newDocument.DocumentNo),n.append("DocumentDate",newDocument.DocumentDate),n.append("NationalCode",newDocument.NationalCode),n.append("Nationality",newDocument.Nationality),n.append("FullName",newDocument.FullName),n.append("Gender",newDocument.Gender),n.append("FatherName",newDocument.FatherName),n.append("Mobile",newDocument.Mobile),n.append("EssentialTel",newDocument.EssentialTel),n.append("EssentialTelRatio",newDocument.EssentialTelRatio),n.append("BirthDate",newDocument.BirthDate),n.append("JobTitle",newDocument.JobTitle),n.append("PostalCode",newDocument.PostalCode),n.append("CityId",newDocument.CityId),n.append("Address",newDocument.Address),n.append("CardNumber",newDocument.CardNumber),n.append("CardNumberOwner",newDocument.CardNumberOwner),n.append("GalleryId",newDocument.GalleryId),n.append("SellerId",newDocument.SellerId),n.append("PrepaymentAmount",newDocument.PrepaymentAmount),n.append("RemainAmount",newDocument.RemainAmount),n.append("InstallmentCount",newDocument.InstallmentCount),n.append("InstallmentAmount",newDocument.InstallmentAmount),n.append("AdminDescription",newDocument.AdminDescription),n.append("IsNewCstomer",newDocument.IsNewCstomer),t=0;t<GuaranteeList.length;t++)n.append(`Collaterals[${t}].ImageFile`,GuaranteeList[t].file),n.append(`Collaterals[${t}].Description`,GuaranteeList[t].description),n.append(`Collaterals[${t}].CollateralTypeId`,GuaranteeList[t].typeId);$.ajax({type:"POST",url:"/Dashboard/Document/CreateDocument",data:n,processData:!1,contentType:!1,success:function(n){n!=undefined&&(ShowAlertToast(n.Type,n.Title,n.Message),n.IsSuccess?(setTimeout(()=>{window.location.reload()},1e3),document.getElementById("frmCreateDocument").reset()):document.getElementById("btnSubmit").disabled=!1)},error:function(n){document.getElementById("btnSubmit").disabled=!1;ShowAlertToast(2,errorInProccessDataInServer,n)}})}function backToStep2(){newDocument.IsNewCstomer?showStep2_2():showStep2_1()}function sort_by_id(){return function(n,t){return n.id<t.id?-1:n.id>t.id?1:0}}function loadGuaranteeList(){var n,t;for(document.getElementById("step4_Installments").innerHTML="",document.getElementById("step3_Installments").innerHTML="",document.getElementById("guranteeListtableBoody").innerHTML="",n=0;n<GuaranteeList.length;n++){t="";GuaranteeList[n].imageFile.length>0&&(t=`<img src='${GuaranteeList[n].imageFile}' />`);let r=`<tr>
                       <td class='td-5'>${n+1}</td >
                       <td class='td-10'>${GuaranteeList[n].type}</td>
                       <td class='td-40'>${GuaranteeList[n].description}</td>
                       <td class='td-25'>${t}</td>
                       <td class='td-20'>
                           <div class="text-align" >
                               <button type="button" class="btn btn-primary" onclick='getForEditGuarantee("${GuaranteeList[n].id}")'><i class="fa fa-edit"></i></button>
                               <button type="button" class="btn btn-danger" onclick='deleteGuarantee("${GuaranteeList[n].id}")'><i class="fa fa-trash"></i></button>
                           </div> 
                       </td>
                    </tr >`;document.getElementById("guranteeListtableBoody").innerHTML+=r;let i="";i=GuaranteeList[n].description.length>0?`${GuaranteeList[n].type} - ${GuaranteeList[n].description}<br>`:`${GuaranteeList[n].type}<br>`;document.getElementById("step4_Installments").innerHTML+=i;document.getElementById("step3_Installments").innerHTML+=i}}function deleteGuarantee(n){try{for(var t=0;t<GuaranteeList.length;t++)if(GuaranteeList[t].id==n)if(confirm("آیا از انجام عملیات مطمئن هستید؟")==!0)GuaranteeList.splice(t,1),loadGuaranteeList(),ShowAlertToast(0,"عملیات موفق","ضمانت با موفقیت حذف شد");else return!1}catch(i){ShowAlertToast(1,"خطا","مشکلی در حذف ضمانت پیش آمد")}}function getForEditGuarantee(n){var t=GuaranteeList.find(t=>t.id==n);$("#guranteeType").val(t.typeId).change();document.getElementById("gurranteeId").value=t.id;document.getElementById("guranteeDescription").value=t.description;document.getElementById("guranteeImageFile").src=`${t.imageFile}`}function addGuarantee(){var n;try{var i=document.getElementById("gurranteeId").value,r=$("#guranteeType option:selected").text(),t=document.getElementById("guranteeType").value,u=document.getElementById("guranteeDescription").value,f=document.getElementById("guranteeFile").value,e="",o;t==""?ShowAlertToast(2,"هشدار","نوع ضمانت را انتخاب کنید"):(i!=""?(n=GuaranteeList.find(n=>n.id==i),n.typeId=t,n.type=r,n.description=u,f!=""&&(n.file=document.getElementById("guranteeFile").files[0],n.imageFile=localStorage.getItem("guranteeFile"))):(f!=""&&(e=localStorage.getItem("guranteeFile"),o=document.getElementById("guranteeFile").files[0]),GuaranteeList.push({id:guranteeId,typeId:t,type:r,description:u,imageFile:e,file:o}),guranteeId+=1),$("#guranteeType").val("").change(),document.getElementById("guranteeDescription").value="",document.getElementById("guranteeFile").value="",document.getElementById("gurranteeId").value="",document.getElementById("guranteeImageFile").src="",localStorage.setItem("guranteeFile",""),loadGuaranteeList(),ShowAlertToast(0,"عملیات موفق","ضمانت با موفقیت ثبت شد"))}catch(s){ShowAlertToast(1,"خطا","مشکلی در افزودن ضمانت پیش آمد")}}function b64toBlob(n,t="",i=512){const r=atob(n),u=[];for(let n=0;n<r.length;n+=i){const t=r.slice(n,n+i),f=new Array(t.length);for(let n=0;n<t.length;n++)f[n]=t.charCodeAt(n);const e=new Uint8Array(f);u.push(e)}return new Blob(u,{type:t})}function getBase64(n){return n.replace(/^data:image\/(png|jpg);base64,/,"")}function getBase64Image(n){var t=document.createElement("canvas"),i,r;return t.width=n.width,t.height=n.height,i=t.getContext("2d"),i.drawImage(n,0,0),r=t.toDataURL("image/png"),r.replace(/^data:image\/(png|jpg);base64,/,"")}function fillStep2_1Data(n){$.ajax({type:"Get",url:`/Dashboard/Document/GetCustomerInfo?nationalCode=${n}`,success:function(n){var t,i;if(n!=undefined)if(n.IsSuccess){if(n.Data!=undefined){newDocument.CustomerId=n.Data.CustomerId;newDocument.FullName=n.Data.FullName;newDocument.NationalCode=n.Data.NationalCode;newDocument.FatherName=n.Data.FatherName;newDocument.NationalCode=n.Data.NationalCode;newDocument.Mobile=n.Data.Mobile;newDocument.EssentialTel=n.Data.EssentialTel;newDocument.EssentialTelRatio=n.Data.EssentialTelRatio;newDocument.CityName=n.Data.CityName;newDocument.ProvinceName=n.Data.ProvinceName;newDocument.Address=n.Data.Address;DocumentList=[];for(let t=0;t<n.Data.Documents.length;++t){const i=n.Data.Documents[t];DocumentList.push({Id:i.Id,DocumentNo:i.DocumentNo,Status:i.Status,Color:i.RowColor})}if(document.getElementById("step2_1_fullname").innerHTML=newDocument.FullName,document.getElementById("step2_1_nationalCode").innerHTML=newDocument.NationalCode,document.getElementById("step2_1_fatherName").innerHTML=newDocument.FatherName,document.getElementById("step2_1_mobile").innerHTML=newDocument.Mobile,document.getElementById("step2_1_essentialTel").innerHTML=newDocument.EssentialTel,document.getElementById("step2_1_essentialTelRatio").innerHTML=newDocument.EssentialTelRatio,document.getElementById("step2_1_city").innerHTML=newDocument.CityName,newDocument.ProvinceName!=""&newDocument.ProvinceName!=null&&(document.getElementById("step2_1_province").innerHTML=newDocument.ProvinceName+"/"),document.getElementById("step2_1_address").innerHTML=newDocument.Address,DocumentList.length>0)for(document.getElementById("step2_1_div_documents").innerHTML="",t=0;t<DocumentList.length;t++)i=` <a href='/Dashboard/Document/Detail?id=${DocumentList[t].Id}' class='btn ${DocumentList[t].Color}' target='_blank'>سند شماره ${DocumentList[t].DocumentNo}</a>`,document.getElementById("step2_1_div_documents").innerHTML+=i}}else ShowAlertToast(n.Type,n.Title,n.Message);else return ShowAlertToast(1,errorInProccessDataInServer,n),!1},error:function(n){return ShowAlertToast(1,errorInConnectToServer,n),!1}})}function setDocumentColorByStatus(n){return n==2?"btn-success":n==1?"btn-info":n==3?"btn-danger":void 0}function InstallmentCountValidate(){var n=document.getElementById("InstallmentCount").value;document.getElementById("InstallmentCountValResult").innerHTML=n==undefined?"تعداد اقساط را وارد نمایید":n<=0?"تعداد اقساط باید بزرگتر از یک باشد":n>250?"تعداد اقساط باید کمتر از 250 باشد":""}function factorAmountCalculator(){var n=removeComma(document.getElementById("RemainAmount").value),t=removeComma(document.getElementById("PrepaymentAmount").value),i;return(isNaN(parseInt(n))!=!0&&InstallmentAmountCalculator(),isNaN(parseInt(n))||isNaN(parseInt(t)))?(document.getElementById("factorAmount").innerHTML,document.getElementById("factorAmount").innerHTML="",!1):(newDocument.FactorAmount=parseInt(n)+parseInt(t),i=`${commaSeparateNumber(newDocument.FactorAmount)} تومان`,document.getElementById("factorAmount").innerHTML=i,!0)}function proccessInstallmentAmount(){var n=removeComma(document.getElementById("InstallmentAmountSystem").value),t=removeComma(document.getElementById("InstallmentAmount").value);if(n!=undefined&&t!=undefined)return parseInt(t)<parseInt(n)?confirm("مبلغ قسط کمتر از مبلغ محاسبه شده توسط سیستم است. آیا مورد تایید است؟")?!0:!1:!0;ShowAlertToast(1,"خطا","خطا در محاسبه مبلغ قسط")}function InstallmentAmountCalculator(){var t=document.getElementById("InstallmentCount").value,n;t==undefined?document.getElementById("InstallmentAmountValResult")!=undefined&&(document.getElementById("InstallmentAmountValResult").innerHTML="تعداد اقساط را وارد نمایید"):t<=0?document.getElementById("InstallmentAmountValResult")!=undefined&&(document.getElementById("InstallmentAmountValResult").innerHTML="تعداد اقساط باید بزرگتر از یک باشد"):t>250?document.getElementById("InstallmentAmountValResult")!=undefined&&(document.getElementById("InstallmentAmountValResult").innerHTML="تعداد اقساط باید کمتر از 250 باشد"):document.getElementById("InstallmentAmountValResult")!=undefined&&(document.getElementById("InstallmentAmountValResult").innerHTML="");n=document.getElementById("RemainAmount").value.replace(",","");n!=undefined&&(isNaN(parseInt(n))==!0?(document.getElementById("InstallmentAmountValResult")!=undefined&&(document.getElementById("InstallmentAmountValResult").innerHTML="مقدار مانده را وارد نمایید"),n="0"):document.getElementById("InstallmentAmountValResult")!=undefined&&(document.getElementById("InstallmentAmountValResult").innerHTML=""));$.ajax({type:"Get",url:`/Dashboard/Document/GetInstallmentAmount?remainAmount=${n}&installmentCount=${t}`,success:function(n){if(n!=undefined)if(n.IsSuccess)document.getElementById("InstallmentAmount").value=n.Data,document.getElementById("InstallmentAmountSystem").value=n.Data;else return 0;else return ShowAlertToast(1,"Error In Load Data!",err),0},error:function(n){ShowAlertToast(1,"Error In Load Data!",n)}})}function InstallmentAmountCalculatorInEditDocument(){var n,t;factorAmountCalculator();n=document.getElementById("InstallmentCount").value;n==undefined?ShowAlertToast(2,"هشدار","تعداد اقساط را وارد نمایید"):n<=0?ShowAlertToast(2,"هشدار","تعداد اقساط باید بزرگتر از یک باشد"):n>250&&ShowAlertToast(2,"هشدار","تعداد اقساط باید کمتر از 250 باشد");t=document.getElementById("RemainAmount").value.replace(",","");t!=undefined&&isNaN(parseInt(t))==!0&&ShowAlertToast(2,"هشدار","مقدار مانده را وارد نمایید");$.ajax({type:"Get",url:`/Dashboard/Document/GetInstallmentAmount?remainAmount=${t}&installmentCount=${n}`,success:function(n){if(n!=undefined)if(n.IsSuccess)document.getElementById("InstallmentAmount").value=n.Data,document.getElementById("InstallmentAmountSystem")!=undefined&&(document.getElementById("InstallmentAmountSystem").value=n.Data);else return 0;else return ShowAlertToast(2,"خطا در محسابه مبلغ اقساط",err),0},error:function(n){ShowAlertToast(2,"خطا در ارتباط با سرور جهت محاسبه مبلغ اقساط",n)}})}function processInstallment(){var t=document.getElementById("InstallmentAmount").value,n=document.getElementById("InstallmentCount").value,i=document.getElementById("RemainAmount").value,r=document.getElementById("PrepaymentAmount").value,u=document.getElementById("AdminDescription").value;$.ajax({type:"Get",url:"/Dashboard/Document/GetInstallmentsDate",data:{installmentCount:n,installmentDate:newDocument.DocumentDate},success:function(f){var s,h,e,o;if(f!=undefined)if(f.IsSuccess){for(newDocument.InstallmentAmount=t,newDocument.InstallmentCount=n,newDocument.RemainAmount=i,newDocument.AdminDescription=u,newDocument.PrepaymentAmount=r,newDocument.SellerName=$("#Seller option:selected").text(),newDocument.GalleryName=$("#Gallery option:selected").text(),newDocument.GalleryId=document.getElementById("Gallery").value,newDocument.SellerId=document.getElementById("Seller").value,e=0;e<f.Data.length;e++)InstallmentList.push({Row:f.Data[e].Row,DelayDays:0,Description:"",InstalmentDate:f.Data[e].PersianDate,PaymentAmount:newDocument.InstallmentAmount});for(document.getElementById("installment_list").innerHTML="",s="checked",h="",e=0;e<InstallmentList.length;e++)o=`<tr>
                                    <td>${InstallmentList[e].Row}</td>
                                    <td>${InstallmentList[e].InstalmentDate}</td>
                                    <td></td>
                                    <td></td>
                                    <td>${newDocument.InstallmentAmount}</td>
                                    <td><input type="checkbox" class='checkbox-disable'></input></td>
                                    <td></td>
                                </tr>`,document.getElementById("installment_list").innerHTML+=o;document.getElementById("step4_nationalcode").innerHTML=newDocument.NationalCode;document.getElementById("step4_docDate").innerHTML=newDocument.DocumentDate;document.getElementById("step4_fullname").innerHTML=newDocument.FullName;document.getElementById("step4_mobile").innerHTML=newDocument.Mobile;document.getElementById("step4_essentiatel").innerHTML=newDocument.EssentialTel;document.getElementById("step4_docNumber").innerHTML=newDocument.DocumentNo;document.getElementById("step4_factorAmount").innerHTML=newDocument.FactorAmount;document.getElementById("step4_prePaymentAmount").innerHTML=newDocument.PrepaymentAmount;document.getElementById("step4_remainAmount").innerHTML=newDocument.RemainAmount;document.getElementById("step4_installmentAmount").innerHTML=newDocument.InstallmentAmount;document.getElementById("step4_gallery").innerHTML=newDocument.GalleryName;document.getElementById("step4_seller").innerHTML=newDocument.SellerName;showStep4()}else ShowAlertToast(f.Type,f.Title,f.Message);else ShowAlertToast(1,"خطا در محاسبه اقساط.",f)},error:function(n){ShowAlertToast(1,errorInProccessDataInServer,n);isExist=!1}})}function showStep1(){document.getElementById("step1").style.display="";document.getElementById("step1_li").className="stepy-active";document.getElementById("step2-1").style.display="none";document.getElementById("step2-2").style.display="none";document.getElementById("step2_li").className="";document.getElementById("step3").style.display="none";document.getElementById("step3_li").className="";document.getElementById("step4").style.display="none";document.getElementById("step4_li").className=""}function showStep2_1(){document.getElementById("step1").style.display="none";document.getElementById("step1_li").className="";document.getElementById("step2-1").style.display="";document.getElementById("step2_li").className="stepy-active";document.getElementById("step2-2").style.display="none";document.getElementById("step3").style.display="none";document.getElementById("step3_li").className="stepy-active";document.getElementById("step4").style.display="none";document.getElementById("step4_li").className="stepy-active"}function showStep2_2(){document.getElementById("step1").style.display="none";document.getElementById("step1_li").className="";document.getElementById("step2-1").style.display="none";document.getElementById("step2-2").style.display="";document.getElementById("step2_li").className="stepy-active";document.getElementById("step3").style.display="none";document.getElementById("step3_li").className="";document.getElementById("step4").style.display="none";document.getElementById("step4_li").className="stepy-active"}function showStep3(){document.getElementById("step1").style.display="none";document.getElementById("step1_li").className="";document.getElementById("step2-1").style.display="none";document.getElementById("step2-2").style.display="none";document.getElementById("step2_li").className="";document.getElementById("step3").style.display="";document.getElementById("step3_li").className="stepy-active";document.getElementById("step4").style.display="none";document.getElementById("step4_li").className=""}function showStep4(){proccessInstallmentAmount()&&(document.getElementById("step1").style.display="none",document.getElementById("step1_li").className="",document.getElementById("step2-1").style.display="none",document.getElementById("step2-2").style.display="none",document.getElementById("step2_li").className="",document.getElementById("step3").style.display="none",document.getElementById("step3_li").className="",document.getElementById("step4").style.display="",document.getElementById("step4_li").className="stepy-active")}function clearInputValueById(n){document.getElementById(n).value=""}function deletePayment(n,t,i){try{confirm(t)==!0&&$.ajax({type:"Get",url:n,success:function(n){n!=undefined&&(ShowAlertToast(n.Type,n.Title,n.Message),n.IsSuccess&&(document.getElementById(i).innerHTML=n.Data,setSwitcheryStyle(),getInstallments(documentId),getInstllmentInfo(documentId)))},error:function(n){ShowAlertToast(1,errorInProccessDataInServer,n)}})}catch(r){ShowAlertToast(2,errorInConnectToServer,r)}}function unPaymentInstallment(n,t){try{confirm(t)==!0&&$.ajax({type:"Get",url:n,success:function(n){n!=undefined&&(ShowAlertToast(n.Type,n.Title,n.Message),n.IsSuccess&&(setTimeout(()=>{window.location.reload()},500),getInstallments(documentId),getInstllmentInfo(documentId)))},error:function(n){ShowAlertToast(1,errorInProccessDataInServer,n)}})}catch(i){ShowAlertToast(2,errorInConnectToServer,i)}}function editDocument(n,t){try{event!=undefined&&event.preventDefault();proccessInstallmentAmount()&&confirm(t)==!0&&$.ajax({type:"POST",url:n.action,data:new FormData(n),contentType:!1,processData:!1,success:function(n){n!=undefined?(ShowAlertToast(n.Type,n.Title,n.Message),n.IsSuccess&&setTimeout(()=>{window.location.reload()},2500)):ShowAlertToast(1,errorInProccessDataInServer,err)},error:function(){ShowAlertToast(2,errorInConnectToServer,e)}})}catch(e){ShowAlertToast(1,errorInConnectToServer,e)}}function delayAmountChang(){document.getElementById("delayAmountLable").innerHTML=document.getElementById("DelayAmount").value}function getInstallments(n){$.ajax({type:"Get",url:"/Dashboard/Document/GetInstallmentList",data:{documentId:n},success:function(n){n.IsSuccess&&(document.getElementById("installments").innerHTML=n.Data)},error:function(n){ShowAlertToast(1,errorInProccessDataInServer,n)}})}function getInstllmentInfo(n){$.ajax({type:"Get",url:"/Dashboard/Document/GetInstallmentInfo",data:{documentId:n},success:function(n){n.IsSuccess?document.getElementById("instllmentInfo").innerHTML=n.Data:ShowAlertToast(n.Type,n.Title,n.Message)},error:function(n){ShowAlertToast(1,errorInProccessDataInServer,n)}})}function getCollateralsInfo(n){$.ajax({type:"Get",url:"/Dashboard/Document/GetCollateralInfo",data:{documentId:n},success:function(n){n.IsSuccess&&(document.getElementById("collateralsInfo").innerHTML=n.Data)},error:function(n){ShowAlertToast(1,errorInProccessDataInServer,n)}})}function clear_form_createOrEditPayment(){document.getElementById("PersianPaymentDate").value="";document.getElementById("PaymentAmount").value="";document.getElementById("inputFile").value="";document.getElementById("previewImg").src="";document.getElementById("previewImg").style.display="none";document.getElementById("btnImgDel").style.display="none";document.getElementById("IsPayInstallment").checked=!1;document.getElementById("DelayDay").value="";document.getElementById("Description").value="";document.getElementById("CustomerMessageContent").value="";document.getElementById("PaymentId").value="0";$("#PaymentType").val("").change();togleShowElement(document.getElementById("IsPayInstallment"),"installmentOptions")}function clear_form_collateral(){$("#CollateralTypeId").val("").change();document.getElementById("CollateralId").value="0";document.getElementById("Description").value="";document.getElementById("inputFile1").value="";document.getElementById("previewImg1").src="";document.getElementById("previewImg1").style.display="none";document.getElementById("btnImgDel1").style.display="none"}function clear_form_gurantee(){$("#guranteeType").val("").change();document.getElementById("gurranteeId").value="";document.getElementById("guranteeDescription").value="";document.getElementById("guranteeFile").value="";document.getElementById("guranteeImageFile").src=""}function DelayCalculation(){try{var n=document.getElementById("InstallmentId").value,t=document.getElementById("PersianPaymentDate").value,i=document.getElementById("PaymentId").value;$.ajax({type:"Get",url:"/Dashboard/Document/CalculationInstallmentDelay",data:{installmentId:n,paymentDate:t,selectedPaymentId:i},success:function(n){n!=undefined&&(document.getElementById("DelayDay").value=n.CurrentInstallmentDelayDay)},error:function(n){ShowAlertToast(1,errorInProccessDataInServer,n)}})}catch(r){}}function fillPaymentDescriptionWithDelayDays(n=true){try{var i=document.getElementById("PaymentAmount").value,r=document.getElementById("InstallmentId").value,u=document.getElementById("PaymentId").value,f=document.getElementById("DelayDay").value,e=document.getElementById("PersianPaymentDate").value,o=n,t=new FormData;t.append("PaymentAmount",i);t.append("InstallmentId",r);t.append("PaymentId",u);t.append("DelayDay",f);t.append("PaymentDate",e);t.append("IsCalcWithPaymentDate",o);$.ajax({type:"POST",url:"/Dashboard/Document/GeneratePaymentInfo",data:t,contentType:!1,processData:!1,success:function(n){n.IsSuccess&&(document.getElementById("Description")!=undefined&&(document.getElementById("Description").value=n.Data.Description),document.getElementById("CustomerMessageContent")!=undefined&&(document.getElementById("CustomerMessageContent").value=n.Data.Message),document.getElementById("DelayDay")!=undefined&&(document.getElementById("DelayDay").value=n.Data.DelayDay))},error:function(n){ShowAlertToast(1,errorInProccessDataInServer,n)}})}catch(s){ShowAlertToast(2,errorInConnectToServer,s)}return!1}function fillPaymentDescription(){try{var n=document.getElementById("PaymentAmount").value,t=document.getElementById("InstallmentId").value,i=document.getElementById("PaymentId").value,r=document.getElementById("DelayDay").value,u=`/Dashboard/Document/GetPaymentDescription?installmentId=${parseInt(t)}&paymentId=${parseInt(i)}&amount=${n}&delayDay=${parseInt(r)}`;$.ajax({type:"Get",url:u,success:function(n){n.IsSuccess&&(document.getElementById("Description")!=undefined&&(document.getElementById("Description").value=n.Data.Description),document.getElementById("CustomerMessageContent")!=undefined&&(document.getElementById("CustomerMessageContent").value=n.Data.Message))},error:function(n){ShowAlertToast(1,errorInProccessDataInServer,n)}})}catch(f){ShowAlertToast(2,errorInConnectToServer,f)}return!1}function GetSettleMessage(){var n=document.getElementById("DocumentId").value,t=document.getElementById("SettleDate").value,i=document.getElementById("DeliveryDate").value,r=document.getElementById("ReturnedAmount").value,u=document.getElementById("DiscountAmount").value,f=`/Dashboard/Document/GenerateSettleMessage?documentId=${n}&settleDate=${t}&deliveryDate=${i}&returnedAmount=${r}&discountAmount=${u}`;$.ajax({type:"Get",url:f,success:function(n){n.IsSuccess&&document.getElementById("CustomerSettleMessageContent")!=undefined&&(document.getElementById("CustomerSettleMessageContent").value=n.Data)},error:function(n){ShowAlertToast(1,errorInProccessDataInServer,n)}})}$(document).ready(function(){$("select").select2();$("#DocumentDate").mask("9999/99/99")});let newDocument={CustomerId:0,GalleryId:"",GalleryName:"",SellerId:"",SellerName:"",PrepaymentAmount:"",RemainAmount:"",InstallmentCount:"",InstallmentAmount:"",AdminDescription:"",DelayAmount:"",FactorAmount:0,CityName:"",ProvinceName:"",IsNewCstomer:!1,DocumentNo:"",DocumentDate:"",Nationality:"",NationalCode:"",FullName:"",Gender:"",FatherName:"",Mobile:"",EssentialTel:"",EssentialTelRatio:"",BirthDate:"",JobTitle:"",PostalCode:"",CityId:"",Address:"",CardNumberOwner:"",CardNumber:""},InstallmentList=[],GuaranteeList=[];var isValidStep3=!0,guranteeId=1;let Installment={Row:0,PaymentDate:"",DelayDays:"",PaymentAmount:"",Description:""},DocumentList=[];loadDataAndReProcessStep1=(n,t)=>{try{event!=undefined&&event.preventDefault();$.ajax({type:"Get",url:n,success:function(n){n.IsSuccess?(document.getElementById(t).innerHTML=n.Data,processStep1()):ShowAlertToast(n.Type,n.Title,n.Message)},error:function(n){ShowAlertToast(1,errorInProccessDataInServer,n)}})}catch(i){ShowAlertToast(2,errorInConnectToServer,i)}return!1};submitFormCustomerSummaryInfoAndReProcessStep1=(n,t)=>{try{event!=undefined&&event.preventDefault();var i=document.getElementById("CustomerId").value,r=document.getElementById("CustomerMobile").value;$.ajax({type:"Get",url:"/Dashboard/Customer/IsDuplicateCustomerMobile",data:{id:i,mobile:r},success:function(i){i!=undefined?i?confirm("شماره تلفن همراه وارد شده برای مشتری دیگری ثبت شده است، آیا مایل به ثبت اطلاعات می باشید؟")==!0&&$.ajax({type:"POST",url:n.action,data:new FormData(n),contentType:!1,processData:!1,success:function(n){n!=undefined&&(n.IsSuccess&&(document.getElementById(t).innerHTML=n.Data,processStep1()),ShowAlertToast(n.Type,n.Title,n.Message))},error:function(n){ShowAlertToast(1,errorInProccessDataInServer,n)}}):$.ajax({type:"POST",url:n.action,data:new FormData(n),contentType:!1,processData:!1,success:function(n){n!=undefined&&(n.IsSuccess&&(document.getElementById(t).innerHTML=n.Data,processStep1()),ShowAlertToast(n.Type,n.Title,n.Message))},error:function(n){ShowAlertToast(1,errorInProccessDataInServer,n)}}):ShowAlertToast(1,errorInProccessDataInServer,data)},error:function(n){ShowAlertToast(1,errorInProccessDataInServer,n)}})}catch(u){ShowAlertToast(2,errorInConnectToServer,u)}return!1};submitFormAndShowModal3=(n,t,i)=>{try{event!=undefined&&event.preventDefault();var u="#"+t,f=t+"_body";$.ajax({type:"POST",url:n.action,data:new FormData(n),contentType:!1,processData:!1,success:function(n){n!=undefined&&(n.IsSuccess&&(document.getElementById(i).innerHTML=n.Data,processStep1()),ShowAlertToast(n.Type,n.Title,n.Message))},error:function(n){ShowAlertToast(2,errorInProccessDataInServer,n)}})}catch(r){ShowAlertToast(2,errorInConnectToServer,r)}return!1};$(document).ready(function(){const n=document.getElementById("guranteeFile");try{n.addEventListener("change",n=>{const i=n.target.files[0],t=new FileReader;t.readAsDataURL(i);t.addEventListener("load",()=>{localStorage.setItem("guranteeFile",t.result)})})}catch(t){}});settleDocument=(n,t,i)=>{try{if(event!=undefined&&event.preventDefault(),confirm(i)==!0){var u="#"+t,f=t+"_body";$.ajax({type:"POST",url:n.action,data:new FormData(n),contentType:!1,processData:!1,success:function(n){n!=undefined&&(ShowAlertToast(n.Type,n.Title,n.Message),n.IsSuccess&&setTimeout(()=>{window.location.reload()},3e3))},error:function(n){ShowAlertToast(1,errorInProccessDataInServer,n)}})}}catch(r){ShowAlertToast(1,errorInConnectToServer,r)}return!1};submitFormCollateral=(n,t,i)=>{try{event!=undefined&&event.preventDefault();var r="#"+t,f=t+"_body";$.ajax({type:"POST",url:n.action,data:new FormData(n),contentType:!1,processData:!1,success:function(n){n!=undefined&&(n.IsSuccess&&(clear_form_collateral(),getCollateralsInfo(documentId),document.getElementById(i).innerHTML=n.Data),ShowAlertToast(n.Type,n.Title,n.Message),$(r).modal("show"))},error:function(n){ShowAlertToast(1,errorInConnectToServer,n)}})}catch(u){ShowAlertToast(1,errorInProccessDataInServer,u)}return!1};submitPaymentModalFormAndUpdateTarget=(n,t,i,r)=>{try{event!=undefined&&event.preventDefault();modalId=`#${r}`;$.ajax({type:"POST",url:n.action,data:new FormData(n),contentType:!1,processData:!1,success:function(n){n!=undefined&&(n.IsSuccess&&(getInstallments(i),getInstllmentInfo(i),$(modalId).modal("hide")),ShowAlertToast(n.Type,n.Title,n.Message))},error:function(n){ShowAlertToast(1,errorInProccessDataInServer,n)}})}catch(u){ShowAlertToast(1,errorInConnectToServer,u)}return!1};